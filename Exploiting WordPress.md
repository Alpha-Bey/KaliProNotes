#### WordPress
Word Press is a popular CMS powering one third of all websites on internet
#### CMS
A CMS is a powerful tool that helps build a website without the need to code everything from scratch (or even know how to write code at all).

A CMS is made up of two key components:

- A Content Management Application (CMA) - the interface used to add and manage content.
- A Content Delivery Application (CDA) - the backend that takes the input entered into the CMA and assembles the code into a working, visually appealing website.

####  WordPress Structure
*WordPress can be installed on a Windows, Linux, or Mac OSX host*
- WordPress requires a fully installed and configured LAMP stack (Linux operating system, Apache HTTP Server, MySQL database, and the PHP programming language) before installation on a Linux host. After installation, all WordPress supporting files and directories will be accessible in the webroot located at `/var/www/html`.
##### - File Structure
- `index.php` is the homepage of WordPress.
- `icense.txt` contains useful information such as the version WordPress installed.
- `wp-activate.php` is used for the email activation process when setting up a new WordPress site.
- - `wp-admin` folder contains the login page for administrator access and the backend dashboard. Once a user has logged in, they can make changes to the site based on their assigned permissions. The login page can be located at one of the following paths:
    
    - `/wp-admin/login.php`
    - `/wp-admin/wp-login.php`
    - `/login.php`
    - `/wp-login.php`

This file can also be renamed to make it more challenging to find the login page.

- `xmlrpc.php` is a file representing a feature of WordPress that enables data to be transmitted with HTTP acting as the transport mechanism and XML as the encoding mechanism. This type of communication has been replaced by the WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- - The `wp-config.php` file contains information required by WordPress to connect to the database, such as the database name, database host, username and password, authentication keys and salts, and the database table prefix. This configuration file can also be used to activate DEBUG mode, which can useful in troubleshooting.
- The `wp-content` folder is the main directory where plugins and themes are stored
- - `wp-includes` contains everything except for the administrative components and the themes that belong to the website. This is the directory where core files are stored, such as certificates, fonts, JavaScript files, and widgets.  

#### User Roles
|   |   |
|---|---|
|Administrator|This user has access to administrative features within the website. This includes adding and deleting users and posts, as well as editing source code.|
|Editor|An editor can publish and manage posts, including the posts of other users.|
|Author|Authors can publish and manage their own posts.|
|Contributor|These users can write and manage their own posts but cannot publish them.|
|Subscriber|These are normal users who can browse posts and edit their profiles.|

#### Version Enumeration
- An essential part of the enumeration phase is uncovering the software version number. This is helpful when searching for common misconfiguration
- We can do this by right-clicking anywhere on the current page and selecting "View page source" from the menu or using the keyboard shortcut `[CTRL + U]`
- We can search for the `meta generator` tag using the shortcut `[CTRL + F]` in the browser or use `cURL` along with `grep` from the command line to filter for this information. 
- In older WordPress versions, another source for uncovering version information is the `readme.html` file in WordPress's root directory.
- We can also find information about the installed plugins by reviewing the source code manually by inspecting the page source or filtering for the information using `cURL` and other command-line utilities. 
- The response headers may also contain version numbers for specific plugins.
- Active plugins should not be our only area of focus when assessing a WordPress website. Even if a plugin is deactivated, it may still be accessible, and therefore we can gain access to its associated scripts and functions. Deactivating a vulnerable plugin does not improve the WordPress site's security. It is best practice to either remove or keep up-to-date any unused plugins.
- ***`Directory Indexing`. It allows us to navigate the folder and access files that may contain sensitive information or vulnerable code. It is best practice to disable directory indexing on web servers so a potential attacker cannot gain direct access to any files or folders other than those necessary for the website to function properly.***

#### User Enumeration 
- Enumerating a list of valid users is a critical phase of a WordPress security assessment. Armed with this list, we may be able to guess default credentials or perform a brute force password attack.
- There are two methods for performing manual username enumeration.
 - The first method is reviewing posts to uncover the ID assigned to the user and their corresponding username
 - The second method requires interaction with the `JSON` endpoint, which allows us to obtain a list of users. This was changed in WordPress core after version 4.7.1, and later versions only show whether a user is configured or not.

#### Login 
Once we are armed with a list of valid users, we can mount a password brute-forcing attack to attempt to gain access to the WordPress backend. This attack can be performed via the login page or the `xmlrpc.php` page.

If our POST request against `xmlrpc.php` contains valid credentials, we will receive the following output:
```shell-session
$ curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>admin</value></param><param><value>CORRECT-PASSWORD</value></param></params></methodCall>" http://blog.inlanefreight.com/xmlrpc.php

<?xml version="1.0" encoding="UTF-8"?>
<methodResponse>
  <params>
    <param>
      <value>
      <array><data>
  <value><struct>
  <member><name>isAdmin</name><value><boolean>1</boolean></value></member>
  <member><name>url</name><value><string>http://blog.inlanefreight.com/</string></value></member>
  <member><name>blogid</name><value><string>1</string></value></member>
  <member><name>blogName</name><value><string>Inlanefreight</string></value></member>
  <member><name>xmlrpc</name><value><string>http://blog.inlanefreight.com/xmlrpc.php</string></value></member>
</struct></value>
</data></array>
      </value>
    </param>
  </params>
</methodResponse>
```
if not we will get a 403 error

#### WP-Scan 
- [WPScan](https://github.com/wpscanteam/wpscan) is an automated WordPress scanner and enumeration tool. It determines if the various themes and plugins used by a WordPress site are outdated or vulnerable. It is installed by default on Parrot OS but can also be installed manually with `gem`.
- WP-Scan can pull in vulnerability information from external sources to enhance our scans. We can obtain an API token from [WPVulnDB](https://wpvulndb.com/), which is used by WP-
- Scan to scan for vulnerability and exploit proof of concepts (POC) and reports. The free plan allows up to 50 requests per day. To use the WPVulnDB database, just create an account and copy the API token from the users page. This token can then be supplied to WPScan using the `--api-token` parameter.
- The `--enumerate` flag is used to enumerate various components of the WordPress application such as plugins, themes, and users
-  For example, all plugins can be enumerated using the arguments `--enumerate ap`

#### WordPress-User-Bruteforce

***WPScan can be used to brute force usernames and passwords. The scan report returned three users registered on the website: `admin`, `roger`, and `david`. The tool uses two kinds of login brute force attacks, `xmlrpc` and `wp-login`. The `wp-login` method will attempt to brute force the normal WordPress login page, while the `xmlrpc` method uses the WordPress API to make login attempts through `/xmlrpc.php`. The `xmlrpc` method is preferred as it is faster.***
```shell-session
wpscan --password-attack xmlrpc -t 20 -U admin, david -P passwords.txt --url http://blog.inlanefreight.com
```
#### Automating WordPress Exploitation
```shell-session
exploit/unix/webapp/wp_admin_shell_upload
```

#### WordPress Hardening
- Perform Regular Updates
- Plugin and Theme Management
- Enhance WordPress Security
 - [Sucuri Security](https://wordpress.org/plugins/sucuri-scanner/)

- This plugin is a security suite consisting of the following features:
    - Security Activity Auditing
    - File Integrity Monitoring
    - Remote Malware Scanning
    - Blacklist Monitoring.

 - [iThemes Security](https://wordpress.org/plugins/better-wp-security/)
- iThemes Security provides 30+ ways to secure and protect a WordPress site such as:
    - Two-Factor Authentication (2FA)
    - WordPress Salts & Security Keys
    - Google reCAPTCHA
    - User Action Logging

- [Wordfence Security](https://wordpress.org/plugins/wordfence/)
- Wordfence Security consists of an endpoint firewall and malware scanner.
    - The WAF identifies and blocks malicious traffic.
    - The premium version provides real-time firewall rule and malware signature updates
    - Premium also enables real-time IP blacklisting to block all requests from known most malicious IPs.
- Configuration Management
- Install a plugin that disallows user enumeration so an attacker cannot gather valid usernames to be used in a password spraying attack
- Limit login attempts to prevent password brute-forcing attacks
- Rename the `wp-login.php` login page or relocate it to make it either not accessible to the internet or only accessible by certain IP addresses